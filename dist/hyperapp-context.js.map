{"version":3,"sources":["dist/hyperapp-context.js"],"names":["global","factory","exports","module","require","define","amd","context","hyperapp","this","resolveNode","node","props","Object","assign","Array","isArray","map","n","prototype","concat","apply","filter","attributes","nodeName","children","treeProcessor","processor","withContext","app","initialState","actionDefinitions","originalView","container","state","actions","length","decorator","getDecoration","decoration","child","keys","forEach","name","oc","class","dc","substr","oh","dh","a","b","nestable","view","tagname","_$r","h","key","id","oncreate","el","_$p","_$c","_$x","wired","s","_$u","uninit","init","onupdate","ondestroy","defineProperty","value"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('hyperapp')) :\n    typeof define === 'function' && define.amd ? define(['exports', 'hyperapp'], factory) :\n    (factory((global.context = {}),global.hyperapp));\n}(this, (function (exports,hyperapp) { 'use strict';\n\n    function resolveNode (node, context) {\n        context = context || {};\n        if (node == null) return node\n        if (typeof node === 'function') {\n            return resolveNode(\n                node(\n                    context,\n                    function (props) {\n                        context = Object.assign({}, context, props);\n                    }\n                ),\n                context\n            )\n        }\n        if (Array.isArray(node)) {\n            node = node.map(function (n) { return resolveNode(n, context)});\n            node = Array.prototype.concat.apply([], node);\n            node = node.filter(function (n) { return n != null });\n            return node\n        }\n        if (!node.attributes) return node\n        return {\n            nodeName: node.nodeName,\n            attributes: Object.assign({}, node.attributes),\n            children: resolveNode(node.children, context)\n        }\n    }\n\n    function treeProcessor (processor) {\n        return function (props, children) {\n            return function (context) {\n                return processor(props, resolveNode(children), context)\n            }\n        }\n    }\n\n    function decorator (getDecoration) {\n        return treeProcessor(function (props, children, context){\n            var decoration = getDecoration(props, context);\n            return children.map(function (child) {\n                if (!child.attributes) return child\n                Object.keys(decoration).forEach(function (name) {\n                    if (name === 'class') {\n                        var oc = child.attributes.class;\n                        var dc = decoration.class;\n                        child.attributes.class = (oc ? oc + ' ' : '') + (dc ? dc : '');\n                    } else if (name.substr(0, 2) === 'on') {\n                        var oh = child.attributes[name];\n                        var dh = decoration[name];\n                        child.attributes[name] = !oh ? dh : function (a,b) {oh(a, b); dh(a, b);};\n                    } else {\n                        child.attributes[name] = decoration[name];\n                    }\n                });\n                return child            \n            })\n        })\n    }\n\n    function nestable (state, actions, view, tagname) {\n        actions._$r = function () {return {}};\n        return function (props, children) {\n            return function (context) {\n                return hyperapp.h(tagname || 'x-', {\n                    key: props.key,\n                    id: props.id,\n                    class: props.class,\n                    oncreate: function (el) {\n                        el._$p = props;\n                        el._$c = children;\n                        el._$x = context;\n                        var wired = hyperapp.app(\n                            state,\n                            actions,\n                            function (s, a) {\n                                var node = view(s, a);\n                                if (typeof node === 'function') node = node(el._$p,  el._$c);\n                                node = resolveNode(node, el._$x);\n                                return (node && node.length) ? node[0] : node\n                           },\n                           el\n                        );\n                        el._$r = wired._$r;\n                        el._$u = wired.uninit;\n                        wired.init && wired.init(props);\n                        props.oncreate && props.oncreate(el);\n                    },\n                    onupdate: function (el) {\n                        el._$p = props;\n                        el._$c = children;\n                        el._$x = context;\n                        el._$r();\n                        props.onupdate && props.onupdate(el);\n                    },\n                    ondestroy: function (el) {\n                        el._$u && el._$u();\n                        props.ondestroy && props.ondestroy(el);\n                    }\n                })            \n            }\n        }\n    }\n\n    function _with (app) {\n        return function (initialState, actionDefinitions, originalView, container) {\n            var view = function (state, actions) {\n                var node = resolveNode(originalView(state, actions));\n                return node && (node.length ? node[0] : node)\n            };\n            return app(initialState, actionDefinitions, view, container)\n        }\n    }\n\n    exports.withContext = _with;\n    exports.processor = treeProcessor;\n    exports.decorator = decorator;\n    exports.nestable = nestable;\n\n    Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=hyperapp-context.js.map\n"]}